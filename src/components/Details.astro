---
import { Icon } from 'astro-icon';
import { TableOfContents } from "astro-headless-ui";
import type { HTMLAttributes } from 'astro/types';
import type { Link } from '@/types';
import { getEntryBySlug } from 'astro:content';


export interface Props extends HTMLAttributes<'details'> {
    title?: string;
    url?: string;
    headings: Array<Link>;
    depth?: number;
    max?: number;
    entry?: string;
}

const {
    depth,
    max,
    entry,
    ...attrs
} = Astro.props

let {
    url,
    headings
} = Astro.props

if (entry) {
    const _entry = await getEntryBySlug('docs', entry)
    url = '/docs/' + _entry.slug
    
    const { headings: _headings } = await _entry.render()
    headings = _headings
}

headings = headings?.map(h => ({...h, text: h?.text?.replace(/^#/, '')}))

const { title=headings[0].text } = Astro.props
---

<details {...attrs}>
    <summary>
        {title}
        <Icon name="radix-icons:caret-up" size={24}/>
    </summary>
    <TableOfContents {...{
        url,
        headings,
        depth,
        max
    }}/>
</details>